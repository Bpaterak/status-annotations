"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function e(e,t,a,n){return new(a||(a=Promise))((function(i,o){function s(e){try{r(n.next(e))}catch(e){o(e)}}function l(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,l)}r((n=n.apply(e,t||[])).next())}))}let t=210,a=figma.currentPage,n=0,i=0;function o(e){let t=[];return e&&e.forEach(e=>{e.parent===a&&("COMPONENT"!==e.type&&"FRAME"!==e.type&&"INSTANCE"!==e.type&&"GROUP"!==e.type||(t.push(e),console.log(t)))}),t}function s(e){let t=e.id,n=a.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);e.setSharedPluginData("statusannotations","status",""),n&&n.children.forEach(e=>{let a=e.getPluginData("frameId");t===a&&(e.remove(),i++)})}function l(){let e=a.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);e&&(e.children.forEach(e=>{let t=e.getPluginData("frameId"),a=figma.getNodeById(t);if(a){let t=a.y-e.height-8,i=a.x+a.width-e.width;e.x!=i&&e.y!=t&&n++,e.x=i,e.y=t}else e.remove(),n++}),1===n?figma.notify("1 annotation updated"):n>1&&figma.notify(n+" annotations updated"),e.parent.insertChild(0,e)),n=0}function r(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}l(),"refresh"===figma.command?(l(),figma.closePlugin()):figma.showUI(__html__,{width:184,height:t}),figma.ui.onmessage=n=>{switch(n.type){case"height":t=n.height,figma.ui.resize(184,t);break;case"addStatus":!function(t){e(this,void 0,void 0,(function*(){let e=o(figma.currentPage.selection);if(0!==e.length){let n=0,i=figma.createFrame();i.counterAxisSizingMode="AUTO",i.layoutMode="HORIZONTAL",i.itemSpacing=4,i.horizontalPadding=6,i.verticalPadding=4,i.name="annotation",i.topLeftRadius=3,i.topRightRadius=3,i.strokes=[{type:"SOLID",visible:!0,opacity:1,blendMode:"NORMAL",color:r("#DBDBDB")}],i.strokeWeight=1;let o=figma.createText();o.name=t.title;let l={family:"Inter",style:"Regular"};yield figma.loadFontAsync(l),o.fontName=l,o.fontSize=12,o.lineHeight={value:16,unit:"PIXELS"},o.characters=t.title;let f=figma.createNodeFromSvg(t.icon);f.name="icon-"+t.slug,f.layoutAlign="CENTER",i.insertChild(0,o),i.insertChild(1,f);let c=[];c.push(i);let u=figma.group(c,a);u.name=t.title;let d=r(t.color);d=Object.assign({a:1},d),u.effects=[{blendMode:"NORMAL",color:d,offset:{x:0,y:-2},radius:0,type:"INNER_SHADOW",visible:!0}],e.forEach(e=>{let i;s(e),i=0===n?u:u.clone();let o=e.id,l=e.y-i.height-8,r=e.x+e.width-i.width;i.x=r,i.y=l,i.setPluginData("frameId",o);let f=a.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);if(f)f.appendChild(i),f.parent.insertChild(0,f);else{let e=[];e.push(i);let t=figma.group(e,a);t.name="status_annotations",t.locked=!0,t.expanded=!1,t.parent.insertChild(0,t)}"INSTANCE"!=e.type&&e.setRelaunchData({status:t.title}),e.setSharedPluginData("statusannotations","status",t.title),a.setRelaunchData({refresh:""}),n++})}else figma.notify("Please select a top level frame, component, or group")}))}(n.status);break;case"delete":!function(){let e=o(figma.currentPage.selection);0!==e.length?(e.forEach(e=>{s(e),"INSTANCE"!=e.type&&e.setRelaunchData({})}),1===i?figma.notify("1 annotation removed"):i>1&&figma.notify(i+" annotations removed")):figma.notify("Please select a frame, component, or group with a status");i=0}();break;case"deleteAll":!function(){let e=a.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);e&&e.remove();o(figma.currentPage.children).forEach(e=>{"INSTANCE"!=e.type&&e.setRelaunchData({})}),a.setRelaunchData({}),figma.notify("All annotations removed")}();break;case"refresh":l()}};
